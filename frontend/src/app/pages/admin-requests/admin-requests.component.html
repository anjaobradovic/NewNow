<div class="admin-requests-container">
  <div class="header">
    <h1>Account Registration Requests</h1>
    <div class="filter-controls">
      <label for="statusFilter">Filter by status:</label>
      <select
        id="statusFilter"
        [(ngModel)]="filterStatus"
        (change)="onFilterChange()"
        class="form-select"
      >
        <option value="PENDING">Pending</option>
        <option value="ACCEPTED">Accepted</option>
        <option value="REJECTED">Rejected</option>
        <option value="ALL">All</option>
      </select>
    </div>
  </div>

  <div class="requests-list" *ngIf="filteredRequests.length > 0; else noRequests">
    <div class="request-card" *ngFor="let request of filteredRequests">
      <div class="card-header">
        <div class="user-info">
          <h3>{{ request.name }}</h3>
          <span class="email">{{ request.email }}</span>
        </div>
        <span [class]="'badge ' + getStatusBadgeClass(request.status)">
          {{ request.status }}
        </span>
      </div>

      <div class="card-body">
        <div class="info-grid">
          <div class="info-item" *ngIf="request.phoneNumber">
            <span class="label">Phone:</span>
            <span class="value">{{ request.phoneNumber }}</span>
          </div>
          <div class="info-item" *ngIf="request.birthday">
            <span class="label">Birthday:</span>
            <span class="value">{{ formatDate(request.birthday) }}</span>
          </div>
          <div class="info-item">
            <span class="label">Address:</span>
            <span class="value">{{ request.address }}</span>
          </div>
          <div class="info-item" *ngIf="request.city">
            <span class="label">City:</span>
            <span class="value">{{ request.city }}</span>
          </div>
          <div class="info-item">
            <span class="label">Created:</span>
            <span class="value">{{ formatDate(request.createdAt) }}</span>
          </div>
        </div>

        <div
          class="rejection-reason"
          *ngIf="request.status === RequestStatus.REJECTED && request.rejectionReason"
        >
          <span class="label">Rejection Reason:</span>
          <p>{{ request.rejectionReason }}</p>
        </div>
      </div>

      <div class="card-actions" *ngIf="request.status === RequestStatus.PENDING">
        <button class="btn btn-success" (click)="approveRequest(request)" [disabled]="isProcessing">
          <i class="fas fa-check"></i> Approve
        </button>
        <button class="btn btn-danger" (click)="openModal(request)" [disabled]="isProcessing">
          <i class="fas fa-times"></i> Reject
        </button>
      </div>
    </div>
  </div>

  <ng-template #noRequests>
    <div class="no-requests">
      <i class="fas fa-inbox"></i>
      <p>No {{ filterStatus === 'ALL' ? '' : filterStatus.toLowerCase() }} requests found</p>
    </div>
  </ng-template>
</div>

<!-- Rejection Modal -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>Reject Registration Request</h2>
      <button class="close-btn" (click)="closeModal()">&times;</button>
    </div>

    <div class="modal-body" *ngIf="selectedRequest">
      <p>You are about to reject the registration request for:</p>
      <p class="user-details">
        <strong>{{ selectedRequest.name }}</strong> ({{ selectedRequest.email }})
      </p>

      <div class="form-group">
        <label for="rejectionReason">Rejection Reason *</label>
        <textarea
          id="rejectionReason"
          [(ngModel)]="rejectionReason"
          rows="4"
          placeholder="Please provide a reason for rejection..."
          class="form-control"
        ></textarea>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="closeModal()" [disabled]="isProcessing">
        Cancel
      </button>
      <button
        class="btn btn-danger"
        (click)="rejectRequest()"
        [disabled]="isProcessing || !rejectionReason.trim()"
      >
        {{ isProcessing ? 'Processing...' : 'Reject Request' }}
      </button>
    </div>
  </div>
</div>
